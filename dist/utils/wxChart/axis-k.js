'use strict';

/**
 * Created by ChenChao on 2017/1/3.
 */

var common = require('./common.js');

module.exports = function () {
    return {
        col: 5,
        row: 3,
        showEdg: true,
        showX: true,
        showY: true,
        paddingTop: 0,
        paddingBottom: 0,
        paddingLeft: 0,
        paddingRight: 0,
        color: '#2f2f2f',
        txtColor: 'white',
        lineWidth: 1,
        fontSize: 12,
        yMax: 0,
        yMin: 0,
        metaUnit: false,
        init: function init(ctx, options) {
            var that = this;
            var w = options.width;
            var h = options.height;
            if (w === 'auto') {
                wx.getSystemInfo({
                    success: function success(result) {
                        w = that.canvasWidth = result.windowWidth;
                    }
                });
            }
            if (h === 'auto') {
                h = 225;
            }
            this.metaUnit = options.metaUnit;
            this.initConfig(options.axis);
            this.drawX(ctx, w, h, options.xAxis);
            this.showY && this.drawY(ctx, w, h, options.yAxis);
            return this;
        },
        initConfig: function initConfig(options) {
            this.col = options.col;
            this.row = options.row;
            this.showEdg = options.showEdg;
            this.showX = options.showX;
            this.showY = options.showY;
            this.yMax = options.yMax;
            this.yMin = options.yMin;
            this.paddingTop = options.paddingTop;
            this.paddingBottom = options.paddingBottom;
            this.paddingLeft = options.paddingLeft;
            this.paddingRight = options.paddingRight;
            this.color = options.color;
        },
        drawX: function drawX(ctx, w, h, xOpt) {
            var col = this.col;
            var xLen = xOpt.data.length;
            var type = xOpt.type;
            var times;
            var startX = this.paddingLeft;
            var endX = w - this.paddingRight;
            var startY = this.paddingTop;
            var endY = h - this.paddingBottom;
            ctx.setFontSize(this.fontSize);
            if (this.showX) {
                //todo
                this.onePixelLineTo(ctx, startX, startY, startX, endY, false);
                var step = (w - this.paddingLeft - this.paddingRight) / col;
                for (var i = 1; i < col; i++) {
                    var x = startX + step * i;
                    this.onePixelLineTo(ctx, x, startY, x, endY, false);
                }
                this.onePixelLineTo(ctx, endX, startY, endX, endY, false);
            }
            if (xOpt.times) {
                times = xOpt.times;
                ctx.setFillStyle(this.txtColor);
                ctx.fillText(times[0], startX + 4, endY + this.paddingBottom - 2);
                ctx.fillText(times[1], endX - (times[1].length > 8 ? 90 : 56), endY + this.paddingBottom - 2);
            }
        },
        drawY: function drawY(ctx, w, h, yOpt, xais) {
            var row = this.row;
            var startX = this.paddingLeft;
            var endX = w - this.paddingRight;
            var startY = this.paddingTop;
            var endY = h - this.paddingBottom;
            var step = (h - this.paddingTop - this.paddingBottom) / row;
            var showLabel = yOpt[0].showLabel || true;
            var max = this.yMax;
            var min = this.yMin;

            var labelStep = (max - min) / row;
            var middleIndex = row / 2;
            drawYLine.call(this);
            this.drawYUnit = drawYUnit;

            function drawYLine() {
                this.showEdg && this.onePixelLineTo(ctx, startX, startY + 1, endX, startY + 1, true);
                for (var i = 1; i < row; i++) {
                    var y = startY + step * i;
                    this.onePixelLineTo(ctx, startX, y, endX, y, true);
                }
                this.showEdg && this.onePixelLineTo(ctx, startX, endY - 1, endX, endY - 1, true);
            }

            function drawYUnit() {
                ctx.setFillStyle(this.txtColor);
                showLabel && ctx.fillText(common.metaUnit(max), startX + 3, startY + 12);
                for (var i = 1; i < row; i++) {
                    var y = startY + step * i;
                    if (showLabel) {
                        var label = (max - labelStep * i).toFixed(2);
                        if (i < middleIndex) {
                            ctx.fillText(label, startX + 3, y + 10);
                        }
                        if (i === middleIndex) {
                            ctx.fillText(label, startX + 3, y + 4);
                        }
                        if (i > middleIndex) {
                            ctx.fillText(label, startX + 3, y - 4);
                        }
                    }
                }
                showLabel && ctx.fillText((max - labelStep * i).toFixed(2), startX + 3, startY + step * i - 4);
            }
        },
        onePixelLineTo: function onePixelLineTo(ctx, fromX, fromY, toX, toY, vertical) {
            var backgroundColor = '#1e1e26';
            var currentStrokeStyle = '#2f2f2f';
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.closePath();
            ctx.setLineWidth(2);
            ctx.setStrokeStyle(backgroundColor);
            ctx.stroke();
            ctx.beginPath();
            if (vertical) {
                ctx.moveTo(fromX, fromY);
                ctx.lineTo(toX + 1, toY);
            } else {
                ctx.moveTo(fromX, fromY + 1);
                ctx.lineTo(toX, toY + 1);
            }
            ctx.closePath();
            ctx.setLineWidth(1);
            ctx.setStrokeStyle(currentStrokeStyle);
            ctx.stroke();
        }
    };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF4aXMtay5qcyJdLCJuYW1lcyI6WyJjb21tb24iLCJyZXF1aXJlIiwibW9kdWxlIiwiZXhwb3J0cyIsImNvbCIsInJvdyIsInNob3dFZGciLCJzaG93WCIsInNob3dZIiwicGFkZGluZ1RvcCIsInBhZGRpbmdCb3R0b20iLCJwYWRkaW5nTGVmdCIsInBhZGRpbmdSaWdodCIsImNvbG9yIiwidHh0Q29sb3IiLCJsaW5lV2lkdGgiLCJmb250U2l6ZSIsInlNYXgiLCJ5TWluIiwibWV0YVVuaXQiLCJpbml0IiwiY3R4Iiwib3B0aW9ucyIsInRoYXQiLCJ3Iiwid2lkdGgiLCJoIiwiaGVpZ2h0Iiwid3giLCJnZXRTeXN0ZW1JbmZvIiwic3VjY2VzcyIsInJlc3VsdCIsImNhbnZhc1dpZHRoIiwid2luZG93V2lkdGgiLCJpbml0Q29uZmlnIiwiYXhpcyIsImRyYXdYIiwieEF4aXMiLCJkcmF3WSIsInlBeGlzIiwieE9wdCIsInhMZW4iLCJkYXRhIiwibGVuZ3RoIiwidHlwZSIsInRpbWVzIiwic3RhcnRYIiwiZW5kWCIsInN0YXJ0WSIsImVuZFkiLCJzZXRGb250U2l6ZSIsIm9uZVBpeGVsTGluZVRvIiwic3RlcCIsImkiLCJ4Iiwic2V0RmlsbFN0eWxlIiwiZmlsbFRleHQiLCJ5T3B0IiwieGFpcyIsInNob3dMYWJlbCIsIm1heCIsIm1pbiIsImxhYmVsU3RlcCIsIm1pZGRsZUluZGV4IiwiZHJhd1lMaW5lIiwiY2FsbCIsImRyYXdZVW5pdCIsInkiLCJsYWJlbCIsInRvRml4ZWQiLCJmcm9tWCIsImZyb21ZIiwidG9YIiwidG9ZIiwidmVydGljYWwiLCJiYWNrZ3JvdW5kQ29sb3IiLCJjdXJyZW50U3Ryb2tlU3R5bGUiLCJiZWdpblBhdGgiLCJtb3ZlVG8iLCJsaW5lVG8iLCJjbG9zZVBhdGgiLCJzZXRMaW5lV2lkdGgiLCJzZXRTdHJva2VTdHlsZSIsInN0cm9rZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7OztBQUlBLElBQUlBLFNBQVNDLFFBQVEsVUFBUixD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Q0FBYjtBQUNIO0FBQ0osU0EzSEU7QUE0SEhGLHdCQUFnQix3QkFBVTlCLEdBQVYsRUFBZWlELEtBQWYsRUFBc0JDLEtBQXRCLEVBQTZCQyxHQUE3QixFQUFrQ0MsR0FBbEMsRUFBdUNDLFFBQXZDLEVBQWlEO0FBQzdELGdCQUFJQyxrQkFBa0IsU0FBdEI7QUFDQSxnQkFBSUMscUJBQXFCLFNBQXpCO0FBQ0F2RCxnQkFBSXdELFNBQUo7QUFDQXhELGdCQUFJeUQsTUFBSixDQUFXUixLQUFYLEVBQWtCQyxLQUFsQjtBQUNBbEQsZ0JBQUkwRCxNQUFKLENBQVdQLEdBQVgsRUFBZ0JDLEdBQWhCO0FBQ0FwRCxnQkFBSTJELFNBQUo7QUFDQTNELGdCQUFJNEQsWUFBSixDQUFpQixDQUFqQjtBQUNBNUQsZ0JBQUk2RCxjQUFKLENBQW1CUCxlQUFuQjtBQUNBdEQsZ0JBQUk4RCxNQUFKO0FBQ0E5RCxnQkFBSXdELFNBQUo7QUFDQSxnQkFBR0gsUUFBSCxFQUFhO0FBQ1RyRCxvQkFBSXlELE1BQUosQ0FBV1IsS0FBWCxFQUFrQkMsS0FBbEI7QUFDQWxELG9CQUFJMEQsTUFBSixDQUFXUCxNQUFNLENBQWpCLEVBQW9CQyxHQUFwQjtBQUNILGFBSEQsTUFHTztBQUNIcEQsb0JBQUl5RCxNQUFKLENBQVdSLEtBQVgsRUFBa0JDLFFBQVEsQ0FBMUI7QUFDQWxELG9CQUFJMEQsTUFBSixDQUFXUCxHQUFYLEVBQWdCQyxNQUFNLENBQXRCO0FBQ0g7QUFDRHBELGdCQUFJMkQsU0FBSjtBQUNBM0QsZ0JBQUk0RCxZQUFKLENBQWlCLENBQWpCO0FBQ0E1RCxnQkFBSTZELGNBQUosQ0FBbUJOLGtCQUFuQjtBQUNBdkQsZ0JBQUk4RCxNQUFKO0FBQ0g7QUFsSkUsS0FBUDtBQW9KSCxDQXJKRCIsImZpbGUiOiJheGlzLWsuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgQ2hlbkNoYW8gb24gMjAxNy8xLzMuXG4gKi9cblxudmFyIGNvbW1vbiA9IHJlcXVpcmUoJy4vY29tbW9uJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGNvbDogNSxcbiAgICAgICAgcm93OiAzLFxuICAgICAgICBzaG93RWRnOiB0cnVlLFxuICAgICAgICBzaG93WDogdHJ1ZSxcbiAgICAgICAgc2hvd1k6IHRydWUsXG4gICAgICAgIHBhZGRpbmdUb3A6IDAsXG4gICAgICAgIHBhZGRpbmdCb3R0b206IDAsXG4gICAgICAgIHBhZGRpbmdMZWZ0OiAwLFxuICAgICAgICBwYWRkaW5nUmlnaHQ6IDAsXG4gICAgICAgIGNvbG9yOiAnIzJmMmYyZicsXG4gICAgICAgIHR4dENvbG9yOiAnd2hpdGUnLFxuICAgICAgICBsaW5lV2lkdGg6IDEsXG4gICAgICAgIGZvbnRTaXplOiAxMixcbiAgICAgICAgeU1heDogMCxcbiAgICAgICAgeU1pbjogMCxcbiAgICAgICAgbWV0YVVuaXQ6IGZhbHNlLFxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoY3R4LCBvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgdyA9IG9wdGlvbnMud2lkdGg7XG4gICAgICAgICAgICB2YXIgaCA9IG9wdGlvbnMuaGVpZ2h0O1xuICAgICAgICAgICAgaWYodyA9PT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICAgICAgd3guZ2V0U3lzdGVtSW5mbyh7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHcgPSB0aGF0LmNhbnZhc1dpZHRoID0gcmVzdWx0LndpbmRvd1dpZHRoO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihoID09PSAnYXV0bycpe1xuICAgICAgICAgICAgICAgIGggPSAyMjU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm1ldGFVbml0ID0gb3B0aW9ucy5tZXRhVW5pdDtcbiAgICAgICAgICAgIHRoaXMuaW5pdENvbmZpZyhvcHRpb25zLmF4aXMpO1xuICAgICAgICAgICAgdGhpcy5kcmF3WChjdHgsIHcsIGgsIG9wdGlvbnMueEF4aXMpO1xuICAgICAgICAgICAgdGhpcy5zaG93WSAmJiB0aGlzLmRyYXdZKGN0eCwgdywgaCwgb3B0aW9ucy55QXhpcyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcbiAgICAgICAgaW5pdENvbmZpZzogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMuY29sID0gb3B0aW9ucy5jb2w7XG4gICAgICAgICAgICB0aGlzLnJvdyA9IG9wdGlvbnMucm93O1xuICAgICAgICAgICAgdGhpcy5zaG93RWRnID0gb3B0aW9ucy5zaG93RWRnO1xuICAgICAgICAgICAgdGhpcy5zaG93WCA9IG9wdGlvbnMuc2hvd1g7XG4gICAgICAgICAgICB0aGlzLnNob3dZID0gb3B0aW9ucy5zaG93WTtcbiAgICAgICAgICAgIHRoaXMueU1heCA9IG9wdGlvbnMueU1heDtcbiAgICAgICAgICAgIHRoaXMueU1pbiA9IG9wdGlvbnMueU1pbjtcbiAgICAgICAgICAgIHRoaXMucGFkZGluZ1RvcCA9IG9wdGlvbnMucGFkZGluZ1RvcDtcbiAgICAgICAgICAgIHRoaXMucGFkZGluZ0JvdHRvbSA9IG9wdGlvbnMucGFkZGluZ0JvdHRvbTtcbiAgICAgICAgICAgIHRoaXMucGFkZGluZ0xlZnQgPSBvcHRpb25zLnBhZGRpbmdMZWZ0O1xuICAgICAgICAgICAgdGhpcy5wYWRkaW5nUmlnaHQgPSBvcHRpb25zLnBhZGRpbmdSaWdodDtcbiAgICAgICAgICAgIHRoaXMuY29sb3IgPSBvcHRpb25zLmNvbG9yO1xuICAgICAgICB9LFxuICAgICAgICBkcmF3WDogZnVuY3Rpb24gKGN0eCwgdywgaCwgeE9wdCkge1xuICAgICAgICAgICAgdmFyIGNvbCA9IHRoaXMuY29sO1xuICAgICAgICAgICAgdmFyIHhMZW4gPSB4T3B0LmRhdGEubGVuZ3RoO1xuICAgICAgICAgICAgdmFyIHR5cGUgPSB4T3B0LnR5cGU7XG4gICAgICAgICAgICB2YXIgdGltZXM7XG4gICAgICAgICAgICB2YXIgc3RhcnRYID0gdGhpcy5wYWRkaW5nTGVmdDtcbiAgICAgICAgICAgIHZhciBlbmRYID0gdyAtIHRoaXMucGFkZGluZ1JpZ2h0O1xuICAgICAgICAgICAgdmFyIHN0YXJ0WSA9IHRoaXMucGFkZGluZ1RvcDtcbiAgICAgICAgICAgIHZhciBlbmRZID0gaCAtIHRoaXMucGFkZGluZ0JvdHRvbTtcbiAgICAgICAgICAgIGN0eC5zZXRGb250U2l6ZSh0aGlzLmZvbnRTaXplKTtcbiAgICAgICAgICAgIGlmKHRoaXMuc2hvd1gpe1xuICAgICAgICAgICAgICAgIC8vdG9kb1xuICAgICAgICAgICAgICAgIHRoaXMub25lUGl4ZWxMaW5lVG8oY3R4LCBzdGFydFgsIHN0YXJ0WSwgc3RhcnRYLCBlbmRZLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgdmFyIHN0ZXAgPSAodyAtIHRoaXMucGFkZGluZ0xlZnQgLSB0aGlzLnBhZGRpbmdSaWdodCkgLyBjb2w7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBjb2w7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IHN0YXJ0WCArIHN0ZXAgKiBpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uZVBpeGVsTGluZVRvKGN0eCwgeCwgc3RhcnRZLCB4LCBlbmRZLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMub25lUGl4ZWxMaW5lVG8oY3R4LCBlbmRYLCBzdGFydFksIGVuZFgsIGVuZFksIGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHhPcHQudGltZXMpe1xuICAgICAgICAgICAgICAgIHRpbWVzID0geE9wdC50aW1lcztcbiAgICAgICAgICAgICAgICBjdHguc2V0RmlsbFN0eWxlKHRoaXMudHh0Q29sb3IpO1xuICAgICAgICAgICAgICAgIGN0eC5maWxsVGV4dCh0aW1lc1swXSwgc3RhcnRYICsgNCwgZW5kWSArIHRoaXMucGFkZGluZ0JvdHRvbSAtIDIpO1xuICAgICAgICAgICAgICAgIGN0eC5maWxsVGV4dCh0aW1lc1sxXSwgZW5kWCAtICh0aW1lc1sxXS5sZW5ndGggPiA4ID8gOTAgOiA1NiksIGVuZFkgKyB0aGlzLnBhZGRpbmdCb3R0b20gLSAyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZHJhd1k6IGZ1bmN0aW9uIChjdHgsIHcsIGgsIHlPcHQsIHhhaXMpIHtcbiAgICAgICAgICAgIHZhciByb3cgPSB0aGlzLnJvdztcbiAgICAgICAgICAgIHZhciBzdGFydFggPSB0aGlzLnBhZGRpbmdMZWZ0O1xuICAgICAgICAgICAgdmFyIGVuZFggPSB3IC0gdGhpcy5wYWRkaW5nUmlnaHQ7XG4gICAgICAgICAgICB2YXIgc3RhcnRZID0gdGhpcy5wYWRkaW5nVG9wO1xuICAgICAgICAgICAgdmFyIGVuZFkgPSBoIC0gdGhpcy5wYWRkaW5nQm90dG9tO1xuICAgICAgICAgICAgdmFyIHN0ZXAgPSAoaCAtIHRoaXMucGFkZGluZ1RvcCAtIHRoaXMucGFkZGluZ0JvdHRvbSkgLyByb3c7XG4gICAgICAgICAgICB2YXIgc2hvd0xhYmVsID0geU9wdFswXS5zaG93TGFiZWwgfHwgdHJ1ZTtcbiAgICAgICAgICAgIHZhciBtYXggPSB0aGlzLnlNYXg7XG4gICAgICAgICAgICB2YXIgbWluID0gdGhpcy55TWluO1xuXG4gICAgICAgICAgICB2YXIgbGFiZWxTdGVwID0gKG1heCAtIG1pbikgLyByb3c7XG4gICAgICAgICAgICB2YXIgbWlkZGxlSW5kZXggPSByb3cgLyAyO1xuICAgICAgICAgICAgZHJhd1lMaW5lLmNhbGwodGhpcyk7XG4gICAgICAgICAgICB0aGlzLmRyYXdZVW5pdCA9IGRyYXdZVW5pdDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZnVuY3Rpb24gZHJhd1lMaW5lKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0VkZyAmJiB0aGlzLm9uZVBpeGVsTGluZVRvKGN0eCwgc3RhcnRYLCBzdGFydFkgKyAxLCBlbmRYLCBzdGFydFkgKyAxLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAxOyBpIDwgcm93OyBpKyspe1xuICAgICAgICAgICAgICAgICAgICB2YXIgeSA9IHN0YXJ0WSArIHN0ZXAgKiBpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uZVBpeGVsTGluZVRvKGN0eCwgc3RhcnRYLCB5LCBlbmRYLCB5LCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93RWRnICYmIHRoaXMub25lUGl4ZWxMaW5lVG8oY3R4LCBzdGFydFgsIGVuZFkgLSAxLCBlbmRYLCBlbmRZIC0gMSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZ1bmN0aW9uIGRyYXdZVW5pdCgpIHtcbiAgICAgICAgICAgICAgICBjdHguc2V0RmlsbFN0eWxlKHRoaXMudHh0Q29sb3IpO1xuICAgICAgICAgICAgICAgIHNob3dMYWJlbCAmJiBjdHguZmlsbFRleHQoY29tbW9uLm1ldGFVbml0KG1heCksIHN0YXJ0WCArIDMsIHN0YXJ0WSArIDEyKTtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAxOyBpIDwgcm93OyBpKyspe1xuICAgICAgICAgICAgICAgICAgICB2YXIgeSA9IHN0YXJ0WSArIHN0ZXAgKiBpO1xuICAgICAgICAgICAgICAgICAgICBpZihzaG93TGFiZWwpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gKG1heCAtIGxhYmVsU3RlcCAqIGkpLnRvRml4ZWQoMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpIDwgbWlkZGxlSW5kZXgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsVGV4dChsYWJlbCwgc3RhcnRYICsgMywgeSArIDEwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGkgPT09IG1pZGRsZUluZGV4KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFRleHQobGFiZWwsIHN0YXJ0WCArIDMsIHkgKyA0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGkgPiBtaWRkbGVJbmRleCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxUZXh0KGxhYmVsLCBzdGFydFggKyAzLCB5IC0gNCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2hvd0xhYmVsICYmIGN0eC5maWxsVGV4dCgobWF4IC0gbGFiZWxTdGVwICogaSkudG9GaXhlZCgyKSwgc3RhcnRYICsgMywgc3RhcnRZICsgc3RlcCAqIGkgLSA0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb25lUGl4ZWxMaW5lVG86IGZ1bmN0aW9uIChjdHgsIGZyb21YLCBmcm9tWSwgdG9YLCB0b1ksIHZlcnRpY2FsKSB7XG4gICAgICAgICAgICB2YXIgYmFja2dyb3VuZENvbG9yID0gJyMxZTFlMjYnO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRTdHJva2VTdHlsZSA9ICcjMmYyZjJmJztcbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIGN0eC5tb3ZlVG8oZnJvbVgsIGZyb21ZKTtcbiAgICAgICAgICAgIGN0eC5saW5lVG8odG9YLCB0b1kpO1xuICAgICAgICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICAgICAgY3R4LnNldExpbmVXaWR0aCgyKTtcbiAgICAgICAgICAgIGN0eC5zZXRTdHJva2VTdHlsZShiYWNrZ3JvdW5kQ29sb3IpO1xuICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgaWYodmVydGljYWwpIHtcbiAgICAgICAgICAgICAgICBjdHgubW92ZVRvKGZyb21YLCBmcm9tWSk7XG4gICAgICAgICAgICAgICAgY3R4LmxpbmVUbyh0b1ggKyAxLCB0b1kpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdHgubW92ZVRvKGZyb21YLCBmcm9tWSArIDEpO1xuICAgICAgICAgICAgICAgIGN0eC5saW5lVG8odG9YLCB0b1kgKyAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgICAgIGN0eC5zZXRMaW5lV2lkdGgoMSk7XG4gICAgICAgICAgICBjdHguc2V0U3Ryb2tlU3R5bGUoY3VycmVudFN0cm9rZVN0eWxlKTtcbiAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgICAgfVxuICAgIH07XG59OyJdfQ==